name: test-linux

on: [push]

jobs:
  ubuntu:
    runs-on: ubuntu-latest
    container: ubuntu:latest
    steps:
      # - uses: actions/checkout@v2
      - name: Install basic requirements
        run: apt-get update && apt-get -y upgrade && apt-get install -y sudo make zsh
      - name: Install Linuxbrew requirements
        run: apt-get install -y gcc build-essential procps curl file git
      - name: Clone this repo
        run: git clone --depth 1 https://github.com/nobu-g/dotfiles.git
      - name: Install dotfiles
        run: make install
        working-directory: ./dotfiles
      - name: Test commands
        run: make test
        working-directory: ./dotfiles
    env:
      DEBIAN_FRONTEND: noninteractive

  centos:
    runs-on: ubuntu-latest
    container: centos:latest
    steps:
      - name: Install basic requirements
        run: yum update -y && yum upgrade -y && yum install -y sudo make zsh
      - name: Install Linuxbrew requirements
        run: |
          yum install -y gcc
          yum groupinstall -y 'Development Tools'
          yum install -y procps-ng curl file git
      - name: Install other requirements
        run: yum install -y perl-ExtUtils-MakeMaker glibc-devel
      - name: Clone this repo
        run: git clone --depth 1 https://github.com/nobu-g/dotfiles.git
      - name: Install dotfiles
        run: make install
        working-directory: ./dotfiles
      - name: Test commands
        run: make test
        working-directory: ./dotfiles

  fedora:
    runs-on: ubuntu-latest
    container: fedora:latest
    steps:
      - name: Install basic requirements
        run: dnf update -y && dnf upgrade -y && dnf install -y sudo make zsh
      - name: Install Linuxbrew requirements
        run: |
          dnf install -y gcc
          dnf group install -y 'Development Tools'
          dnf clean all && dnf install -y procps-ng curl file git libxcrypt-compat
      - name: Install other requirements
        run: dnf install -y g++ perl-ExtUtils-MakeMaker perl-FindBin glibc-devel
      - name: Clone this repo
        run: git clone --depth 1 https://github.com/nobu-g/dotfiles.git
      - name: Install dotfiles
        run: make install
        working-directory: ./dotfiles
      - name: Test commands
        run: make test
        working-directory: ./dotfiles

  rockylinux:
    runs-on: ubuntu-latest
    container: rockylinux/rockylinux:latest
    steps:
      - name: Install basic requirements
        run: dnf update -y && dnf upgrade -y && dnf install -y sudo make zsh
      - name: Install Linuxbrew requirements
        run: |
          dnf install -y gcc
          dnf group install -y 'Development Tools'
          dnf clean all && dnf install -y procps-ng curl file git libxcrypt-compat
      - name: Install other requirements
        run: dnf install -y g++ perl-ExtUtils-MakeMaker perl-FindBin glibc-devel
      - name: Clone this repo
        run: git clone --depth 1 https://github.com/nobu-g/dotfiles.git
      - name: Install dotfiles
        run: make install
        working-directory: ./dotfiles
      - name: Test commands
        run: make test
        working-directory: ./dotfiles

  # alpine:
  #   runs-on: ubuntu-latest
  #   container: alpine:latest
  #   steps:
  #     - name: Install required packages
  #       run: apk add --no-cache bash bc coreutils curl file g++ gawk gcc gettext git grep libc-dev make procps ruby ruby-bigdecimal ruby-etc ruby-fiddle ruby-irb ruby-json ruby-test-unit sqlite sudo unzip wget zsh
  #     - name: Clone this repo
  #       run: git clone --depth 1 https://github.com/nobu-g/dotfiles.git
  #     - name: Install dotfiles
  #       run: make install
  #       working-directory: ./dotfiles
  #     - name: Test commands
  #       run: make test
  #       working-directory: ./dotfiles
